# 1. システム概要

**目的:**  
小学校低学年〜高学年が、Unity と C#の基礎から自由制作レベルまでを「遊び感覚」で体系的に学べる Web アプリを実現する。

**主な特徴・機能:**

- **インタラクティブチュートリアル**：ゲーム形式のシナリオに沿って、C#文法やゲームロジックを学ぶレッスンを提供
- **ブロック → テキスト二段階エディタ**：Blockly ベースの直感操作から、徐々に C#テキスト入力へ移行
- **即時フィードバック**：コード実行ごとにキャラクターやステージが反応するリアルタイムシミュレーション
- **ミニクイズ＆ヒント**：各レッスン末に理解度チェック用クイズと、つまずきを防ぐヒント表示
- **ゲーミフィケーション**：バッジ・レベル・デイリーチャレンジなどで学習継続を促進
- **サンドボックスモード**：自由にオリジナルゲームを制作・共有し、創造性を伸ばす
- **アカウント＆進捗管理**：Firebase を活用した認証・学習履歴保存

---

# 2. システム構成

## 2.1 フロントエンド

- **技術スタック:** Next.js（React） + TypeScript + Tailwind CSS
- **UI コンポーネント:**
  - **レッスンプレイヤー:** シナリオの進行に合わせてテキスト／動画／図解を表示
  - **インタラクティブエディタ:**
    - **ブロックエディタ:** Blockly をカスタマイズ
    - **テキストエディタ:** Monaco Editor + シンタックスハイライト／オートコンプリート
    - **実行・フィードバックパネル:** 実行ボタンとキャラクター挙動をリアルタイム表示
  - **クイズコンポーネント:** 複数選択肢・穴埋め形式の問題、正誤フィードバック
  - **ダッシュボード:** 学習進捗・バッジ・デイリーチャレンジ達成状況の可視化
  - **サンドボックス:** 自由制作用キャンバスとシンプルなオブジェクトライブラリ

## 2.2 バックエンド／データストア

- **認証:** Firebase Authentication（メール・Google 連携）
- **データベース:** Firebase Cloud Firestore
  - `users`コレクション：プロフィール、進捗、バッジ、デイリーステータス
  - `lessons`コレクション：レッスン定義、コンテンツ（MDX）、クイズデータ
  - `projects`コレクション：サンドボックス制作物メタデータとデータ
- **サーバーレス API:** Next.js API Routes + Firebase Functions
  - 管理者向け教材編集
  - デイリーチャレンジ生成・通知トリガー

## 2.3 コード実行環境

- **仕組み:**
  - **Try .NET ウィジェット**埋め込み
  - 必要に応じて **Judge0 API** との連携
- **制限:** UnityEngine 依存 API は利用せず、C#基礎文法・簡易アルゴリズム演習に特化
- **視覚サポート:**
  - GIF／動画教材
  - 必要に応じて **Unity WebGL ビルドのデモ**埋め込み

---

# 3. 機能要件

## 3.1 ユーザー管理

- 新規登録・ログイン（メール／Google）
- プロフィール登録（ニックネーム、学年）
- 認証状態の監視と教材アクセス制御

## 3.2 レッスン提供

- **レッスン構成:**
  1. **イントロ＆ストーリー:** 目的説明＋キャラクターガイド
  2. **理論学習:** C#文法・Unity 概念の平易な解説
  3. **実践ワーク:** ブロック／テキストでコードを入力 → 実行
  4. **理解度チェック:** クイズ＋ヒント
- **教材フォーマット:** MDX で記述し、画像・動画・アニメーションを埋め込み
- **進捗管理:** Firestore に学習完了フラグ・スコアを保存

## 3.3 インタラクティブ機能

- **エディタ切替:** 初級はブロック、習熟度に応じてテキストに自動移行提案
- **リアルタイム実行:** 1 ステートずつキャラが動くデモ
- **クイズ＆ヒント:** 正誤即時フィードバック／つまづき防止ヒント
- **エラーハンドリング:** エラー箇所のハイライト＋優しいメッセージ

## 3.4 ゲーミフィケーション

- **バッジ・称号:** レッスン達成・連続学習・チャレンジクリアで付与
- **レベルアップ:** 獲得ポイントに応じてレベルを可視化
- **デイリーチャレンジ:** 毎日別のミニ課題を提示し、クリアでボーナス
- **通知:** Firebase Cloud Messaging で学習リマインド・称号獲得通知

---

# 4. 非機能要件

- **パフォーマンス:**
  - Lazy Load・コードスプリットによる初回ロード最適化
  - Firestore リスナーでリアルタイム更新
- **セキュリティ:**
  - Firebase セキュリティルールでデータアクセス制御
  - API Routes で認証トークン検証・実行環境のサンドボックス化
- **拡張性:**
  - コンポーネントベース設計で教材・機能追加が容易
  - サーバーレス環境は自動スケーリング対応

---

# 5. システムアーキテクチャ・データフロー

```mermaid
flowchart TD
  A[ブラウザ] -->|Auth| B[Next.js]
  B -->|読込/保存| C[Firestore]
  B -->|実行リクエスト| D[Try .NET / Judge0]
  B -->|通知| E[Firebase Functions]
  A <-- D: 実行結果
  A <-- E: リマインド / 賞状通知
```

---

# 6. 開発スケジュール

1. **要件定義・プロトタイプ (2 週間)**
   - ワイヤーフレーム／UI モック
   - Firebase 初期設定／クイックデモ作成
2. **コア機能実装 (4 週間)**
   - レッスンプレイヤー／Firestore 連携
   - エディタ＆実行環境埋込
   - 認証・API Routes
3. **UX テスト＆調整 (2 週間)**
   - 小学生ユーザーテスト
   - フィードバック反映
4. **公開準備・デプロイ (1 週間)**
   - セキュリティルール最終確認
   - Vercel/Firebase Hosting デプロイ

---

# 7. UI/UX ガイドライン

- **配色:** 明るく親しみやすいパステル調、アクセントカラーで操作を誘導
- **フォント＆レイアウト:** 大きめフォント、十分なタップ領域、ふりがな付き用語説明
- **アニメーション:** ボタン・キャラクターにホバー／クリック時のやわらかな動き
- **アクセシビリティ:** 色覚多様性対応、コントラスト比チェック

---

# 8. 今後の拡張計画

- **Unity WebGL 簡易実行:** 基本 2D エンジンを WebAssembly で部分再現
- **管理画面:** 管理者向けコンテンツエディタ実装
- **コミュニティ機能:** 制作物の共有・コメント機能導入

---

# 9. まとめ

本設計書は、小学生の視点に立ち「遊び」と「学び」を融合した Unity(C#)学習 Web アプリを Next.js+TypeScript で実現するための全体像です。

- **ゲーム形式のチュートリアル**で興味を喚起し、
- **ブロック → テキスト**で学習段階に合わせたコード入力体験を提供し、
- **リアルタイムフィードバック**や**ゲーミフィケーション**で継続を支援します。  
  将来的には Wasm によるエンジン再現やコミュニティ機能を加え、子どもたちの創造性を最大限に伸ばすプラットフォームを目指します。
